function [y, T, residual, g1] = dynamic_4(y, x, params, steady_state, sparse_rowval, sparse_colval, sparse_colptr, T)
residual=NaN(18, 1);
  y(69)=y(63)*params(23)+y(66)*params(24)+params(25)*y(70)+y(100);
  y(73)=(1-params(7))*y(74)+params(7)*y(68)-y(101);
  residual(1)=(y(71))-(y(70)+y(18));
  residual(2)=(y(71))-(y(72)+y(74)-y(68));
  residual(3)=(y(69))-(params(6)*(params(7)*y(71)+(1-params(7))*y(72)+y(101)));
  residual(4)=(params(14)*y(76))-(y(74)-(y(75)+y(103)+params(14)*y(77)));
  residual(5)=(y(75))-((1-params(15))*y(13)+params(15)/(1-params(1)/params(2))*(y(63)-y(1)*params(1)/params(2)));
  residual(6)=(y(80))-(params(48)*y(18)+y(66)*(1-params(48))+y(99)*params(49));
  residual(7)=(y(64))-(params(17)*y(2)+(1-params(17))*(y(65)*params(18)+params(19)*y(81)+params(20)*(y(81)-y(19)))-y(105));
  residual(8)=(y(81))-(y(69)-y(97));
  residual(9)=(y(84)-params(8)*y(22))-(params(45)*(y(146)-y(84)*params(8))-params(46)*(100*y(102)-y(73)+100*y(107)));
  residual(10)=(y(77)-y(15))-(params(3)*(y(139)-y(77))+params(50)*(y(72)-y(77)));
  residual(11)=(y(82)-params(8)*y(20))-(params(45)*(y(144)-y(82)*params(8))-params(46)*(100*y(102)-y(73)));
  residual(12)=(y(63))-(params(40)*y(125)+(1-params(40))*y(1)-params(41)*(y(64)-y(127)-y(98)));
  residual(13)=(y(66))-(params(42)*y(4)+(1-params(42))*y(128)+params(43)*y(67)+y(99));
  residual(14)=(y(83)-params(8)*y(21))-(params(45)*(y(145)-y(83)*params(8))-params(46)*(100*y(102)-y(73)+100*y(106)));
  residual(15)=(y(65))-(params(36)*y(83)+params(37)*y(84)+(1-params(36)-params(37))*y(82));
  residual(16)=(y(65)+y(74)-y(12))-(params(11)*y(3)+params(3)*(y(127)+y(136)-y(74)-y(65)*params(11))-params(47)*(params(14)*y(76)-100*y(104)));
  residual(17)=(y(70))-(y(68)*(1-params(16))/params(16));
  residual(18)=(y(67))-(params(44)*y(130)-(y(64)-y(127)-y(98))+(1-params(44))*y(129));
if nargout > 3
    g1_v = NaN(78, 1);
g1_v(1)=(-(1-params(15)));
g1_v(2)=(-1);
g1_v(3)=(-params(48));
g1_v(4)=(-params(17));
g1_v(5)=(-((1-params(17))*(-params(20))));
g1_v(6)=(-params(8));
g1_v(7)=(-1);
g1_v(8)=(-params(8));
g1_v(9)=(-(params(15)/(1-params(1)/params(2))*(-(params(1)/params(2)))));
g1_v(10)=(-(1-params(40)));
g1_v(11)=(-params(42));
g1_v(12)=(-params(8));
g1_v(13)=(-params(11));
g1_v(14)=(-1);
g1_v(15)=(-1);
g1_v(16)=params(25);
g1_v(17)=(-params(25));
g1_v(18)=1;
g1_v(19)=(-1);
g1_v(20)=(-(params(6)*(1-params(7))));
g1_v(21)=(-params(50));
g1_v(22)=1;
g1_v(23)=1;
g1_v(24)=(-(params(6)*params(7)));
g1_v(25)=params(14);
g1_v(26)=params(47)*params(14);
g1_v(27)=1;
g1_v(28)=1;
g1_v(29)=1;
g1_v(30)=1;
g1_v(31)=params(41);
g1_v(32)=1;
g1_v(33)=(-((1-params(17))*(params(19)+params(20))));
g1_v(34)=1;
g1_v(35)=1-params(45)*(-params(8));
g1_v(36)=(-params(37));
g1_v(37)=params(14);
g1_v(38)=1-((-params(3))-params(50));
g1_v(39)=1-params(45)*(-params(8));
g1_v(40)=(-(1-params(36)-params(37)));
g1_v(41)=params(23);
g1_v(42)=(-(params(15)/(1-params(1)/params(2))));
g1_v(43)=(-params(23));
g1_v(44)=1;
g1_v(45)=params(24);
g1_v(46)=(-(1-params(48)));
g1_v(47)=(-params(24));
g1_v(48)=1;
g1_v(49)=1-params(45)*(-params(8));
g1_v(50)=(-params(36));
g1_v(51)=(-((1-params(17))*params(18)));
g1_v(52)=1;
g1_v(53)=1-params(3)*(-params(11));
g1_v(54)=(-1);
g1_v(55)=(-1);
g1_v(56)=params(46)*(-(1-params(7)));
g1_v(57)=params(46)*(-(1-params(7)));
g1_v(58)=params(46)*(-(1-params(7)));
g1_v(59)=1+params(3);
g1_v(60)=1;
g1_v(61)=params(46)*(-params(7));
g1_v(62)=params(46)*(-params(7));
g1_v(63)=params(46)*(-params(7));
g1_v(64)=(-((1-params(16))/params(16)));
g1_v(65)=(-params(43));
g1_v(66)=1;
g1_v(67)=(-params(45));
g1_v(68)=(-params(3));
g1_v(69)=(-params(45));
g1_v(70)=(-params(40));
g1_v(71)=(-(1-params(42)));
g1_v(72)=(-params(45));
g1_v(73)=(-params(41));
g1_v(74)=(-params(3));
g1_v(75)=(-1);
g1_v(76)=(-params(3));
g1_v(77)=(-params(44));
g1_v(78)=(-(1-params(44)));
    if ~isoctave && matlab_ver_less_than('9.8')
        sparse_rowval = double(sparse_rowval);
        sparse_colval = double(sparse_colval);
    end
    g1 = sparse(sparse_rowval, sparse_colval, g1_v, 18, 54);
end
end
